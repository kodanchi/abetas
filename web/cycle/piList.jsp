<%@ page import="ASDB.C_AS_Select" %>
<%@ page import="java.util.ArrayList" %>
<%@ page import="java.sql.SQLException" %>
<%@ page import="ASDB.AS_Select" %>

<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<script src="/js/jquery-2.2.0.min.js" type="text/javascript"></script>
<script src="/js/bootbox.min.js" type="text/javascript"></script>
<script src="/js/flat-ui.min.js" type="text/javascript"></script>
<script src="/js/flat-ui-select.js" type="text/javascript"></script>


<%
    /**
     * used to display list of performance indicators page.
     */

    String id = "";
    if(request.getParameter("cycle") != null){
        id  = request.getParameter("cycle");
    }

%>

<%

    if(request.getParameter("status") != null){

        out.print("<script type=\"text/javascript\">\n" +
                "    $(window).load(function(){\n" +
                "       bootbox.alert(\""+request.getParameter("status")+"\")\n" +
                "    });\n" +
                "</script>");
    }

%>


<%
    String ulogo = (String) config.getServletContext().getAttribute("ulogo");
    String uname = (String) config.getServletContext().getAttribute("uname");
    String cname = (String) config.getServletContext().getAttribute("cname");

    if(ulogo!= null){
        out.println("<div id=\"print-note\" class=\" centerI\" > \n" +
                "                            <img width=\"135px\" class=\"\" " +
                "src=\""+ulogo+"\" alt=\""+uname+"\"></div>");
    }
%>

<h6 id="print-note">This ducument was generated by ABETAS for <%=cname%>, <%=uname%></h6>

        <div class="container">
            <div class="row">
                <div class="col-md-7 col-md-offset-2">
                    <nav>
                        <ol class="cd-breadcrumb triangle small">
                            <li class="current"><em>PI</em></li>
                            <li><em>Rubrics Names</em></li>
                            <li><em>Terms</em></li>
                        </ol>
                    </nav>
                </div>
            </div>
            <!-- Here is row -->
            <div class="row">

            <h2 class="text-center">Add Program Performance Indicator</h2>

                <div class="col-md-8 col-md-offset-2">




                        <select class="form-control select select-primary select-block mbl" id="prgList" onchange="onPrgramChange(<%=id%>)" data-live-search="true">
                            <option data-tokens="select">Select program</option>

                                    <%
                                        C_AS_Select select = new C_AS_Select();
                                        try {
                                            ArrayList<ArrayList<String>> rs = select.selectAllPrograms();
                                            ArrayList<String> rsRow;


                                            for (int i=0; i<rs.size();i++) {
                                                rsRow = rs.get(i);

                                                out.print("<option data-tokens=\""+rsRow.get(1)+"\" " );

                                                if(request.getParameter("programID")!=null && request.getParameter("programID").equals(rsRow.get(0))){
                                                    out.print(" selected=\"selected\" ");
                                                }

                                                        out.print(" value=\""+rsRow.get(0)+"\">"+rsRow.get(1)+"</option>");

                                            }
                                            if(request.getParameter("programID")!=null){
                                                out.print("<script>\n" +
                                                        "                                $(document).ready(function(){\n" +
                                                        "                                            onPrgramChange("+id+");\n" +
                                                        "                                        });\n" +
                                                        "                            </script>");
                                            }
                                        } catch (ClassNotFoundException e) {
                                            e.printStackTrace();
                                        } catch (SQLException e) {
                                            e.printStackTrace();
                                        }
                                    %>

                            <script>
                                function onPrgramChange(cid){
                                    var pl = document.getElementById("prgList");
                                    var pid = pl.options[pl.selectedIndex].value;
                                    if(pid == "Select program"){
                                        $("#pIList").hide();
                                    }else {
                                        show('page', false);
                                        show('loading', true);
                                        $.ajax({
                                            type: 'POST',
                                            data: {
                                                cid: cid,
                                                pid: pid
                                            },
                                            url: '/selectPI',
                                            success: function (result) {
                                                $('#pIList').html(result);
                                                $('#pIList').show();
                                                show('page', true);
                                                show('loading', false);

                                            }

                                        })
                                    }
                                }
                            </script>
                    </select>
                        </div>

                        <br>
                        <br>
                        <br>

                            <input name="cycle" value="<%=id%>" hidden/>




                <div id="pIList"></div>


                <a class="btn btn-primary btn-fill pull-right" href="index.jsp?page=rubricNames&cycle=<%=id%>">Next</a>
                    <a class="btn btn-default pull-right" href="index.jsp">Cancel</a>


                    <!-- End of col -->
                </div>
                <!-- End of row -->
            </div>

        </div>
